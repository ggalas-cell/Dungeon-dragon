#include "game.h"

Game::Game() : isrunning(false), function(Gamefunction::menu) {}

void Game::Initialise()
{
    std::cout << "=== Initialisation de la partie ===\n";
    isrunning = true;
    char keyinput = 0;
    char up = 'z';
    char down = 's';
    char left = 'q';
    char right = 'd';
    function = Gamefunction::menu;
    
}

void Game::GameLoop()
{
    while(isrunning)
    {
        switch(function)
        {
            case Gamefunction::menu:
                Menu();
                break;
            case Gamefunction::play:
                PlayGame();
                break;
            case Gamefunction::map:
                //displaygrid();
                break;
            
            case Gamefunction::fight:
            std::cout << R"(
                                                                                           
                                                                                           
                FFFFFFFFFFFFFFFFFFFFFF  iiii                     hhhhhhh                     tttt          
                F::::::::::::::::::::F i::::i                    h:::::h                  ttt:::t          
                F::::::::::::::::::::F  iiii                     h:::::h                  t:::::t          
                FF::::::FFFFFFFFF::::F                           h:::::h                  t:::::t          
                    F:::::F       FFFFFFiiiiiii    ggggggggg   gggggh::::h hhhhh      ttttttt:::::ttttttt    
                    F:::::F             i:::::i   g:::::::::ggg::::gh::::hh:::::hhh   t:::::::::::::::::t    
                    F::::::FFFFFFFFFF    i::::i  g:::::::::::::::::gh::::::::::::::hh t:::::::::::::::::t    
                    F:::::::::::::::F    i::::i g::::::ggggg::::::ggh:::::::hhh::::::htttttt:::::::tttttt    
                    F:::::::::::::::F    i::::i g:::::g     g:::::g h::::::h   h::::::h     t:::::t          
                    F::::::FFFFFFFFFF    i::::i g:::::g     g:::::g h:::::h     h:::::h     t:::::t          
                    F:::::F              i::::i g:::::g     g:::::g h:::::h     h:::::h     t:::::t          
                    F:::::F              i::::i g::::::g    g:::::g h:::::h     h:::::h     t:::::t    tttttt
                FF:::::::FF           i::::::ig:::::::ggggg:::::g h:::::h     h:::::h     t::::::tttt:::::t
                F::::::::FF           i::::::i g::::::::::::::::g h:::::h     h:::::h     tt::::::::::::::t
                F::::::::FF           i::::::i  gg::::::::::::::g h:::::h     h:::::h       tt:::::::::::tt
                FFFFFFFFFFF           iiiiiiii    gggggggg::::::g hhhhhhh     hhhhhhh         ttttttttttt  
                                                            g:::::g                                          
                                                gggggg      g:::::g                                          
                                                g:::::gg   gg:::::g                                          
                                                g::::::ggg:::::::g                                          
                                                gg:::::::::::::g                                           
                                                    ggg::::::ggg                                             
                                                        gggggg                                                )";
                std::this_thread::sleep_for(std::chrono::seconds(1));
                Fight();
                break;
            case Gamefunction::training:
                std::cout << R"(                                                                                       
                       ......................................................................................       
                       ......................................................................................       
                       ......................................................................................       
                       ......................................................................................       
                       ......................................................................................       
                       ...............................:-*%%%%%%%%%%%%%%%%*-..................................       
                       ...........................=#%%%%%%%%%%%%%%%%%%%%%%%%%%*-.............................       
                       ........................#%%%%%%%%%%#+=*%%%%%#*=*#%%%%%%%%%%+..........................       
                       .....................+%%%%%%%##*%%%%%%%%%%%%%%%%%%%%*##%%%%%%%=.......................       
                       ...................#%%%%%%*#%%%%%%%%%%%%%%%%%%%%%%%%%%%%#*%%%%%%*.....................       
                       .................*%%%%%##%%%%%%%%#+==============+#%%%%%%%%*#%%%%%+...................       
                       ...............+%%%%%*%%%%%%%*=======================+#%%%%%%##%%%%%-.................       
                       ..............%%%%%#%%%%%%#========+*+========**+========%%%%%%%%%%%%*................       
                       ............:%%%%%#%%%%%*======++==================++======#%%%%%*%%%%%...............       
                       ...........-%%%%#%%%%%#=====+=========+*###*+=========++=====%%%%%#%%%%%:.............       
                       ..........-%%%%*%%%%%=====+======+#***************+=====++====+%%%%##%%%%:............       
                       .........:%%%%*%%%%%====++=====********************#*=====*+===+%%%%##%%%%............       
                       .........#%%%%%%%%%====+=====%*****###********##******#====++====%%%%#%%%%+...........       
                      .........+%%%%#%%%%+===*====+*****##********###***##****#+===++===+%%%%*%%%%-..........       
                      .........%%%%#%%%%*===+====*****##****##%-::=#******##****+===+====#%%%%#%%%*..........       
                      ........-%%%%#%%%%+==++===***#*#***##+::::::::::+#***##****+===*====%%%%+%%%%:.........       
                      ........#%%%#%%%%*++=+====#####****+::::::::::::::****##***#===+++=+#%%%%%%%%+.........       
                      ........#%%%#%%%@++++#+=+*##*######::::=:::::--::::#*###*###++=+*+++*%%%%%%%%*.........       
                      ........#%%%#%%%%++++*++=#########=:::-:::::::-::::+#**#**##*+++#+++*%%%%#%%%*.........       
                      ........#%%%#@%%@++++*+++#########=:::=::::::::::::+########*+++#+++*%%%%#%%%*.........       
                      ........#%%@#@%@@*+++#+++*########*::::+::::::=::::#########++++#+++*%%%%%%%%*.........       
                      ........#@%%#%@%%*++++++++#########+:::::-*+-:::::*#########++++++++#%%%%%%%%+.........       
                      ........-%%%%#@%@%++++++++*####%####*-::::::::::=#####%####*++++++++%%%%+%%%%:.........       
                      .........%@@@#@%%%*+++*++++*####%######*-::::=*###########*++++++++#%%%%#%%%*..........       
                      .........+@%%%%@%@%++++#++++*############################*++++*++++%%%%*@@@%-..........       
                      ..........#@@@%%@@@%++++*+++++#######%##########%######%+++++*++++%@@@#%%%%*...........       
                      ..........:@@@@*@@@@%++++*+++++*######################+++++*+++++%@@@%#%%%%:...........       
                      ...........-@@@@*%@@@%+++++*++++++##################++++++*++++*@@@@%#@@@@:............       
                      ............-@@@@#%@@@@#+++++*++++++++**%%%%%%**++++++++*+++++%@@@@#%@@@%:.............       
                      .............:@@@@%*@@@@@*++++++*+++++++++++++++++++**++++++#@@@@@*@@@@%:..............       
                      ...............%@@@@#%@@@@@#+++++++**#++++++++++#**+++++++#@@@@@%%@@@@#................       
                      ................+@@@@@*%@@@@@@*+++++++++++++++++++++++*#@@@@@@%#@@@@@-:................       
                      .................:#@@@@@##@@@@@@@%#+++++++++++++++*#%@@@@@@@#%@@@@@+::......:....::....       
                      ...............::..:%@@@@@%*%@@@@@@@@@@@%%%%%@@@@@@@@@@@@*#@@@@@@+:::::::.........:....       
                      ....:...........::::::*@@@@@@@%##@@@@@@@@@@@@@@@@@@@%#*%@@@@@%%=:........:.....:.......       
                      ...............::::::::::+%%@@@@@@@%##*+*%%%%*+*##%@@@@@@@@%=:::::.......:.......:::...       
                     ..:::::.:::::::::::::::::::::-#%%%%%@%@@@@@@@@@@@@@@@%%%%*-:::::::...:::::::::::::.:.::. ......
                     ..:::::.::::::::::::::::::.:::::::=+#%%%%%%%%%%%%%%*+=:::::..::::::::::...::.::.:::::::. ...   
                    ..:::::::..:::::::::::.:::.:::::..::::::::::::::::::::::..::..::::::.:::::::::::::::::::. ......
                   ...::::::::.:.....::::::::::::::::::::.::...::.::.::...::..::..::::::::::::::::::::::::::. ...   
                   ...::.:::::.....:.::::::::::::::::::::..::..::....::...:::::::.::..::::::::::::::::::::::. ......
                  ....::.::::::..:...::....:....:...................................................::::::::........
                  ....:....::::.....................................................................................
                 ...............     .....    ......    .....    ..  ..   ......   ......     ...     ..       .....
                 ...............     .....    ..  ..    .        ... ..     ..     ..   .    .....    ..       ..   
                .........................     ..        ....     . ....     ..     ......    .. ..    ..       .....
                ......      ............      ..  ..    .        .  ...     ..     ..  ..   .......   ..       ..   
                .....        .........        ......    .....    .   ..     ..     ..  ..   ..   ..   ......   .....
                )";
                std::cout << R"(

                  ____ _                                               _         
                 / ___| |__   __ _ _ __ __ _  ___ _ __ ___   ___ _ __ | |_       
                | |   | '_ \ / _` | '__/ _` |/ _ \ '_ ` _ \ / _ \ '_ \| __|      
                | |___| | | | (_| | | | (_| |  __/ | | | | |  __/ | | | |_ _ _ _ 
                 \____|_| |_|\__,_|_|  \__, |\___|_| |_| |_|\___|_| |_|\__(_|_|_)
                                       |___/                                     

                )";
                std::this_thread::sleep_for(std::chrono::seconds(3));
                break;
            case Gamefunction::win:
                std::cout << R"(

                                                                                    
                                                                                  
             ___  ___    .--.    ___  ___     ___  ___  ___        ___ .-.  
            (   )(   )  /    \  (   )(   )   (   )(   )(   )(''") (   )   \ 
             | |  | |  |  .-. ;  | |  | |     | |  | |  | |  | |   |  .-. . 
             | |  | |  | |  | |  | |  | |     | |  | |  | |  | |   | |  | | 
             | '  | |  | |  | |  | |  | |     | |  | |  | |  | |   | |  | | 
             '  `-' |  | |  | |  | |  | |     | |  | |  | |  | |   | |  | | 
              `.__. |  | '  | |  | |  ; '     | |  ; '  | |  | |   | |  | | 
              ___ | |  '  `-' /  ' `-'  /     ' `-'   `-' '  | |   | |  | | 
             (   )' |   `.__.'    '.__.'       '.__.'.__.'  (___) (___)(___)
              ; `-' '                                                       
               .__.'                                                                                                       
            )";
                function = Gamefunction::play;
                break;
            case Gamefunction::loose:
                std::cout << R"(
					
	
                            						  ______			                                ______                                 
                            						 /      \                                          /      \                                
                            						/$$$$$$  |  ______   _____  ____    ______        /$$$$$$  | __     __   ______    ______  
                            						$$ | _$$/  /      \ /     \/    \  /      \       $$ |  $$ |/  \   /  | /      \  /      \ 
                            						$$ |/    | $$$$$$  |$$$$$$ $$$$  |/$$$$$$  |      $$ |  $$ |$$  \ /$$/ /$$$$$$  |/$$$$$$  |
                            						$$ |$$$$ | /    $$ |$$ | $$ | $$ |$$    $$ |      $$ |  $$ | $$  /$$/  $$    $$ |$$ |  $$/ 
                            						$$ \__$$ |/$$$$$$$ |$$ | $$ | $$ |$$$$$$$$/       $$ \__$$ |  $$ $$/   $$$$$$$$/ $$ |      
                            						$$    $$/ $$    $$ |$$ | $$ | $$ |$$       |      $$    $$/    $$$/    $$       |$$ |      
                            						 $$$$$$/   $$$$$$$/ $$/  $$/  $$/  $$$$$$$/        $$$$$$/      $/      $$$$$$$/ $$/       
                        

                          _____                    _____                    _____                    _____                           _______                   _____                    _____                    _____          
                         /\    \                  /\    \                  /\    \                  /\    \                         /::\    \                 /\    \                  /\    \                  /\    \         
                        /::\    \                /::\    \                /::\____\                /::\    \                       /::::\    \               /::\____\                /::\    \                /::\    \        
                       /::::\    \              /::::\    \              /::::|   |               /::::\    \                     /::::::\    \             /:::/    /               /::::\    \              /::::\    \       
                      /::::::\    \            /::::::\    \            /:::::|   |              /::::::\    \                   /::::::::\    \           /:::/    /               /::::::\    \            /::::::\    \      
                     /:::/\:::\    \          /:::/\:::\    \          /::::::|   |             /:::/\:::\    \                 /:::/~~\:::\    \         /:::/    /               /:::/\:::\    \          /:::/\:::\    \     
                    /:::/  \:::\    \        /:::/__\:::\    \        /:::/|::|   |            /:::/__\:::\    \               /:::/    \:::\    \       /:::/____/               /:::/__\:::\    \        /:::/__\:::\    \    
                   /:::/    \:::\    \      /::::\   \:::\    \      /:::/ |::|   |           /::::\   \:::\    \             /:::/    / \:::\    \      |::|    |               /::::\   \:::\    \      /::::\   \:::\    \   
                  /:::/    / \:::\    \    /::::::\   \:::\    \    /:::/  |::|___|______    /::::::\   \:::\    \           /:::/____/   \:::\____\     |::|    |     _____    /::::::\   \:::\    \    /::::::\   \:::\    \  
                 /:::/    /   \:::\ ___\  /:::/\:::\   \:::\    \  /:::/   |::::::::\    \  /:::/\:::\   \:::\    \         |:::|    |     |:::|    |    |::|    |    /\    \  /:::/\:::\   \:::\    \  /:::/\:::\   \:::\____\ 
                /:::/____/  ___\:::|    |/:::/  \:::\   \:::\____\/:::/    |:::::::::\____\/:::/__\:::\   \:::\____\        |:::|____|     |:::|    |    |::|    |   /::\____\/:::/__\:::\   \:::\____\/:::/  \:::\   \:::|    |
                \:::\    \ /\  /:::|____|\::/    \:::\  /:::/    /\::/    / ~~~~~/:::/    /\:::\   \:::\   \::/    /         \:::\    \   /:::/    /     |::|    |  /:::/    /\:::\   \:::\   \::/    /\::/   |::::\  /:::|____|
                 \:::\    /::\ \::/    /  \/____/ \:::\/:::/    /  \/____/      /:::/    /  \:::\   \:::\   \/____/           \:::\    \ /:::/    /      |::|    | /:::/    /  \:::\   \:::\   \/____/  \/____|:::::\/:::/    / 
                  \:::\   \:::\ \/____/            \::::::/    /               /:::/    /    \:::\   \:::\    \                \:::\    /:::/    /       |::|____|/:::/    /    \:::\   \:::\    \            |:::::::::/    /  
                   \:::\   \:::\____\               \::::/    /               /:::/    /      \:::\   \:::\____\                \:::\__/:::/    /        |:::::::::::/    /      \:::\   \:::\____\           |::|\::::/    /   
                    \:::\  /:::/    /               /:::/    /               /:::/    /        \:::\   \::/    /                 \::::::::/    /         \::::::::::/____/        \:::\   \::/    /           |::| \::/____/    
                     \:::\/:::/    /               /:::/    /               /:::/    /          \:::\   \/____/                   \::::::/    /           ~~~~~~~~~~               \:::\   \/____/            |::|  ~|          
                      \::::::/    /               /:::/    /               /:::/    /            \:::\    \                        \::::/    /                                      \:::\    \                |::|   |          
                       \::::/    /               /:::/    /               /:::/    /              \:::\____\                        \::/____/                                        \:::\____\               \::|   |          
                        \::/____/                \::/    /                \::/    /                \::/    /                         ~~                                               \::/    /                \:|   |          
                         ~~                       \/____/                  \/____/                  \/____/                                                                            \/____/                  \|___|          
                                                                                                                                                                                                                            
                                                                                              
	            )" << '\n';
                ShutDown();
                break;
            case Gamefunction::leave:
                ShutDown();
                break;
            
        }
    }
}

void Game::Menu()
{   
    system("cls");
    std::cout << R"(
    $$\      $$\                               
    $$$\    $$$ |                              
    $$$$\  $$$$ | $$$$$$\  $$$$$$$\  $$\   $$\ 
    $$\$$\$$ $$ |$$  __$$\ $$  __$$\ $$ |  $$ |
    $$ \$$$  $$ |$$$$$$$$ |$$ |  $$ |$$ |  $$ |
    $$ |\$  /$$ |$$   ____|$$ |  $$ |$$ |  $$ |
    $$ | \_/ $$ |\$$$$$$$\ $$ |  $$ |\$$$$$$  |
    \__|     \__| \_______|\__|  \__| \______/ 
                                                                                                                         
    )";
    std::cout << "\n";
    std::cout<<"1. Lancer le jeu\n ";
    std::cout << "3. Infinite Fights\n";
    std::cout << "3.  Quitter\n";
    std::cout << "\n";
    std::cout << "/->";
    std::cin >> inp;
    switch(inp)
    {
        case 1:
            function = Gamefunction::play;
            break;
        case 2:
            function = Gamefunction::leave;
            break;
    }
}

int Game::Difficulty()
{
    std::cout << "Choisissez le niveau de difficulter (Easy(1)/Medium(2)/Hard(3)) :";
    std::cin >> diff;
    return diff;
}

void Game::CharacterChoice()
{
   
    std::cout << "Choisissez un personnage :";
    std::cin >> choice;
    switch (choice)
    {
    case 1:
        warrior;
        break;
    case 2:
        wizard;
        break;
    case 3:         //tempo
        archer;
        break;
    }


}
   

void Game::PlayGame(){
    system("cls");
    //keyinput = getch();
    char input;
    std::cout << "\nQue voulez vous faire attaquer (a),fuir (f) ou aller au terrain d'entrainement(t) ?\n";
    std::cout << "\->";
    std::cin >> input;

    switch (input) {
        case 'a':
            function = Gamefunction::fight;
            break;
        case 'f':
            function = Gamefunction::leave;
        case 't':
            function = Gamefunction::training;
            break;
        default:
            std::cout << "Entrée invalide.\n";
            std::this_thread::sleep_for(std::chrono::seconds(1));
            function = Gamefunction::play;
            break;
    }
    return;
}
void Game::Fight()
{
    system("cls");
    turn = 1;
    //condition pour 1 enemie a faire
    while (!warrior->isdead() && !wizard->isdead() && !archer->isdead() && !goblin->isdead() && !skeleton->isdead() && !ghost->isdead())
    {
        std::cout << "Classe :" << warrior->GetName() << "\n";
        std::cout << "\n";
        std::cout << "\n";
        std::cout << "LVL :" << warrior->GetLv() << "\n";
        std::cout << "HP :" << warrior->GetcurrentHp() << "/" << warrior->GetMaxHp() << "\n";
        std::cout << "ATQ :" << warrior->GetDmg() << "\n";
        std::cout << "SPD :" << warrior->GetSpeed() << "\n";
        std::cout << "\n";
        std::cout << "\n";
        if (turn == 1)
        {
            if (warrior->GetLv() > goblin->GetLv())
            {
                goblin->lvup();
            }
            std::cout << "Vous ete tombez sur un " << goblin->GetName() << " sauvage de niveau " << goblin->GetLv()<<".\n";
        }
        std::cout << "\n//  Tour " << turn++ << "  //\n";
        std::cout << "Choisissez votre competence :\n";
        std::cout << "Attaquer(a)      Esquiver(d)\n";
        std::cout << "/->";
        std::cin >> input;
        system("cls");
        switch(input)
        {   
        case'a':
            if (warrior->speed > goblin->speed)
            {
                warrior->attack(*goblin);
                goblin->attack(*warrior);
            }
            else
            {
                goblin->attack(*warrior);
                warrior->attack(*goblin);
            }
            std::cout<<goblin->GetName()<<" a maintenant "<<goblin->GetcurrentHp()<<"/"<<goblin->GetMaxHp();
            break;
        case 'd':
            goblin->attack(*warrior);
            std::cout << warrior->GetName() << " esquive l'attaque.\n";
            warrior->SetDodge(true);
                break;
        default:
            turn--;
            std::cout << "Erreur veuillez saisir un des caractere donne !!!";
        }
            
        if (goblin->isdead())           //win loose
        {
            std::cout << goblin->GetName() << " est mort.\n";
            std::cout << warrior->GetName() << " a gagne.\n";
            std::cout << "Warrior à gagner 50 exp.\n";
            warrior->SetCurrentExp(50);
            function=Gamefunction::win;
            return;
        }
        else if(warrior->isdead())
        {
            std::cout << warrior->GetName() << " est mort.\n";
            function=Gamefunction::loose;
            return;
        }
    }
}
void Game::ResetCharacters() {
    warrior->SetCurrentHp(); 
    goblin->SetCurrentHp();
}

void Game::ShutDown(){
    system("cls");
    isrunning=false;
    std::cout << "///  Fermeture du jeu  ///";
}
